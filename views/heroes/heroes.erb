<form action="/buscar" method="POST">
	<input type="text" name="nombre">
	Héroes:
	<input type="radio" name="criteria" value="heroe" checked="checked" />
	Jugadores:
	<input type="radio" name="criteria" value="jugador" />
	<input type="submit" value="buscar">
</form>
<table id='tresp'>
	<thead>
		<tr>
			<th colspan=3>Héroe</th>
			<th>Nivel</th>
			<th><a href=/familiares>Familiar</a></th>
			<th><a href=/profesiones>Profesión</a></th>
			<th><a href=/armas>Armas</a></th>
			<th><a href=/armaduras>Armadura</a></th>
			<th>Reputación</th>
		</tr>
	</thead>
	<tbody>
		<% if (params[:nombre].to_s.empty? && params[:criteria].to_s.empty?) %>
			<% if params[:param] %>
				<% filtered_heros = heros.select {|h| h.empadronado == params[:param] } %>
			<% else %>
				<% filtered_heros = heros.select {|h| (h.estado || 'ausente' ) == h.lista_status(request.path_info.gsub('/','')) } %>
			<% end %>
		<% else %>
			<% if params[:criteria].to_s == 'heroe' %>
				<% filtered_heros = heros.select {|h| h.name.downcase.include?(params[:nombre].to_s.downcase) } %>
			<% else %>
				<% filtered_heros = heros.select {|h| h.jugador.downcase.include?(params[:nombre].to_s.downcase) } %>
			<% end %>
		<% end %>

		<% filtered_heros.sort_by { |h| [h.nivel,h.reputacion] }.reverse.each do |hero| %>
			<%= erb :'heroes/hero', locals: { hero: hero } %>
		<% end %>
	</tbody>
</table>